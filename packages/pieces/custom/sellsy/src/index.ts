import { createPiece, OAuth2AuthorizationMethod, PieceAuth, OAuth2PropertyValue } from '@activepieces/pieces-framework';
import { createCustomApiCallAction } from '@activepieces/pieces-common';
import { estimateStepUpdated } from './lib/triggers/estimate-step-updated';
import { updateOpportunityStatus } from './lib/actions/update-opportunity-status';
import { OAuth2GrantType } from '@activepieces/shared';

export const oauth2Auth = PieceAuth.OAuth2({
      grantType: OAuth2GrantType.AUTHORIZATION_CODE,
      authorizationMethod: OAuth2AuthorizationMethod.BODY,
      required: true,
      authUrl: 'https://login.slsy.io/oauth2/authorization',
      tokenUrl: 'https://login.slsy.io/oauth2/access-tokens',
      pkce: true,
      scope: [],
    })

    export const sellsy = createPiece({
      displayName: "Sellsy",
      auth: oauth2Auth,
      minimumSupportedRelease: '0.36.1',
      logoUrl: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik05Ljc1NTc1IDBIMzAuMjQ5QzMzLjY0NzEgMCAzNC44ODE1IDAuMzU3Mjc4IDM2LjEyMDYgMS4wMTk0MkMzNy4zNDE2IDEuNjcxNDQgMzguMzM3OSAyLjY3NTY0IDM4Ljk4MDEgMy45MDE0QzM5LjY0NzMgNS4xNDQ3IDQwIDYuMzczNzEgNDAgOS43NzAxNlYzMC4yNTM3QzQwIDMzLjY1MDEgMzkuNjQ3MyAzNC44ODM5IDM4Ljk4MDEgMzYuMTI3MkMzOC4zMzE1IDM3LjM0MjIgMzcuMzM2MiAzOC4zMzcxIDM2LjEyMDYgMzguOTg1M0MzNC44ODE1IDM5LjY0NzUgMzMuNjQ3MSA0MCAzMC4yNDkgNDBIOS43NTU3NUM2LjM1NzY4IDQwIDUuMTIzMzEgMzkuNjQ3NSAzLjg3OTQyIDM4Ljk4NTNDMi42NjQzNCAzOC4zMzY0IDEuNjY5MTkgMzcuMzQxNyAxLjAxOTg5IDM2LjEyNzJDMC4zNTI2NjcgMzQuODgzOSAwIDMzLjY1MDEgMCAzMC4yNTM3VjkuNzcwMTZDMCA2LjM3MzcxIDAuMzUyNjY3IDUuMTQ0NyAxLjAxOTg5IDMuOTAxNEMxLjY2Mjc5IDIuNjc2MTcgMi42NTg5OSAxLjY3MjE2IDMuODc5NDIgMS4wMTk0MkM1LjEzMjg0IDAuMzU3Mjc4IDYuMzU3NjggMCA5Ljc1NTc1IDBaIiBmaWxsPSIjMDIwMTZGIi8+CjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF8zOTo4NzA4KSI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjEuNjQzOCAxOS4yNjc5QzIxLjczNzIgMTkuMjY3OSAyMS44MjY4IDE5LjMwNSAyMS44OTI4IDE5LjM3MUMyMS45NTg5IDE5LjQzNzEgMjEuOTk2IDE5LjUyNjYgMjEuOTk2IDE5LjYyVjE5LjYyVjI2LjE4MjNDMjEuOTk2IDI2LjI3NTcgMjEuOTU4OSAyNi4zNjUzIDIxLjg5MjggMjYuNDMxM0MyMS44MjY4IDI2LjQ5NzMgMjEuNzM3MiAyNi41MzQ0IDIxLjY0MzggMjYuNTM0NEgyMC41ODczQzIwLjQ5NDYgMjYuNTMyMyAyMC40MDYzIDI2LjQ5NDUgMjAuMzQwNyAyNi40Mjg5QzIwLjI3NTIgMjYuMzYzMyAyMC4yMzc0IDI2LjI3NSAyMC4yMzUyIDI2LjE4MjNWMTkuNjJDMjAuMjM1MiAxOS41MjY2IDIwLjI3MjMgMTkuNDM3MSAyMC4zMzgzIDE5LjM3MUMyMC40MDQ0IDE5LjMwNSAyMC40OTM5IDE5LjI2NzkgMjAuNTg3MyAxOS4yNjc5SDIxLjY0MzhaTTE4LjIwODEgMjEuMTgzM0MxOC4yNjA3IDIxLjE4MzMgMTguMzEyOCAyMS4xOTM4IDE4LjM2MTMgMjEuMjE0MkMxOC40MDk4IDIxLjIzNDYgMTguNDUzOCAyMS4yNjQ0IDE4LjQ5MDYgMjEuMzAyQzE4LjUyNzQgMjEuMzM5NiAxOC41NTYzIDIxLjM4NDIgMTguNTc1NiAyMS40MzMyQzE4LjU5NSAyMS40ODIxIDE4LjYwNDMgMjEuNTM0NCAxOC42MDMyIDIxLjU4N1YyMS41ODdWMjYuMTMwN0MxOC42MDQzIDI2LjE4MzMgMTguNTk1IDI2LjIzNTcgMTguNTc1NiAyNi4yODQ2QzE4LjU1NjMgMjYuMzMzNSAxOC41Mjc0IDI2LjM3ODEgMTguNDkwNiAyNi40MTU3QzE4LjQ1MzggMjYuNDUzMyAxOC40MDk4IDI2LjQ4MzIgMTguMzYxMyAyNi41MDM2QzE4LjMxMjggMjYuNTI0IDE4LjI2MDcgMjYuNTM0NSAxOC4yMDgxIDI2LjUzNDRIMTcuMjIwM0MxNy4xNjc0IDI2LjUzNTcgMTcuMTE0NyAyNi41MjYgMTcuMDY1NyAyNi41MDZDMTcuMDE2NiAyNi40ODYxIDE2Ljk3MjIgMjYuNDU2MiAxNi45MzUxIDI2LjQxODRDMTYuODk4MSAyNi4zODA1IDE2Ljg2OTIgMjYuMzM1NSAxNi44NTAzIDI2LjI4NkMxNi44MzE0IDI2LjIzNjUgMTYuODIyOCAyNi4xODM3IDE2LjgyNTIgMjYuMTMwN1YyMS41ODdDMTYuODIyOCAyMS41MzQxIDE2LjgzMTQgMjEuNDgxMiAxNi44NTAzIDIxLjQzMThDMTYuODY5MiAyMS4zODIzIDE2Ljg5ODEgMjEuMzM3MiAxNi45MzUxIDIxLjI5OTRDMTYuOTcyMiAyMS4yNjE1IDE3LjAxNjYgMjEuMjMxNyAxNy4wNjU3IDIxLjIxMTdDMTcuMTE0NyAyMS4xOTE3IDE3LjE2NzQgMjEuMTgyMSAxNy4yMjAzIDIxLjE4MzNIMTguMjA4MVpNMTQuNzcyNCAyMy4xMzMxQzE0Ljg3MjYgMjMuMTMzMSAxNC45Njg3IDIzLjE3MjkgMTUuMDM5NiAyMy4yNDM4QzE1LjExMDUgMjMuMzE0NiAxNS4xNTAzIDIzLjQxMDggMTUuMTUwMyAyMy41MTFWMjMuNTExVjI2LjE1NjVDMTUuMTUwMyAyNi4yNTY4IDE1LjExMDUgMjYuMzUyOSAxNS4wMzk2IDI2LjQyMzhDMTQuOTY4NyAyNi40OTQ2IDE0Ljg3MjYgMjYuNTM0NCAxNC43NzI0IDI2LjUzNDRIMTMuODE4OUMxMy43Njk3IDI2LjUzNDUgMTMuNzIxIDI2LjUyNDYgMTMuNjc1NiAyNi41MDU1QzEzLjYzMDIgMjYuNDg2NCAxMy41ODkxIDI2LjQ1ODUgMTMuNTU0NyAyNi40MjMzQzEzLjUyMDMgMjYuMzg4IDEzLjQ5MzMgMjYuMzQ2MyAxMy40NzUyIDI2LjMwMDVDMTMuNDU3MiAyNi4yNTQ3IDEzLjQ0ODUgMjYuMjA1NyAxMy40NDk2IDI2LjE1NjVWMjMuNTExQzEzLjQ0OTYgMjMuNDEyMiAxMy40ODgyIDIzLjMxNzQgMTMuNTU3MiAyMy4yNDY4QzEzLjYyNjMgMjMuMTc2MSAxMy43MjAyIDIzLjEzNTMgMTMuODE4OSAyMy4xMzMxSDE0Ljc3MjRaTTIyLjY2NTkgMTBDMjQuNjk2NSAxMC4wMDkxIDI2LjY0MDMgMTAuODIzOSAyOC4wNzA1IDEyLjI2NTNDMjkuNTAwNiAxMy43MDY3IDMwLjMwMDEgMTUuNjU2OSAzMC4yOTMzIDE3LjY4NzRDMzEuNzgyNCAxOC4xNTg3IDMzLjA1NiAxOS4xNDMxIDMzLjg4NzMgMjAuNDY1NEMzNC43MTg3IDIxLjc4NzYgMzUuMDUzOSAyMy4zNjIgMzQuODMzMyAyNC45MDgzQzM0LjYxMjcgMjYuNDU0NSAzMy44NTA2IDI3Ljg3MjMgMzIuNjgyNiAyOC45MDk0QzMxLjUxNDcgMjkuOTQ2NCAzMC4wMTY2IDMwLjUzNTQgMjguNDU1MSAzMC41NzE0SDI3LjQzM0MyNy4zMzczIDMwLjU3MTQgMjcuMjQ1NiAzMC41MzM0IDI3LjE3NzkgMzAuNDY1OEMyNy4xMTAzIDMwLjM5ODEgMjcuMDcyMyAzMC4zMDYzIDI3LjA3MjMgMzAuMjEwN1YzMC4yMTA3VjI5LjI0MDFDMjcuMDcyMiAyOS4xNDM2IDI3LjExIDI5LjA1MDkgMjcuMTc3NCAyOC45ODE5QzI3LjI0NDggMjguOTEyOSAyNy4zMzY2IDI4Ljg3MyAyNy40MzMgMjguODcwN0gyOC40NjM3QzI5LjY5NDUgMjguODI4NiAzMC44NjM4IDI4LjMyMjUgMzEuNzM3IDI3LjQ1NDFDMzIuNjEwMiAyNi41ODU3IDMzLjEyMjcgMjUuNDE5MiAzMy4xNzE2IDI0LjE4ODdDMzMuMjIwNiAyMi45NTgxIDMyLjgwMjMgMjEuNzU0NiAzMi4wMDA4IDIwLjgxOTZDMzEuMTk5MyAxOS44ODQ2IDMwLjA3MzggMTkuMjg3MyAyOC44NTAzIDE5LjE0NzZDMjguNzkzMiAxOS4xNDM0IDI4LjczOTggMTkuMTE4MyAyOC43MDAxIDE5LjA3NzFDMjguNjYwNSAxOS4wMzU5IDI4LjYzNzUgMTguOTgxNSAyOC42MzU1IDE4LjkyNDNWMTcuNjg3NEMyOC42MzU1IDE2LjA5MjggMjguMDAyMSAxNC41NjM1IDI2Ljg3NDUgMTMuNDM1OUMyNS43NDY5IDEyLjMwODQgMjQuMjE3NiAxMS42NzQ5IDIyLjYyMyAxMS42NzQ5QzIxLjIyNjMgMTEuNjc4MyAxOS44NzU1IDEyLjE3MzUgMTguODA3NSAxMy4wNzM0QzE3LjczOTQgMTMuOTczNCAxNy4wMjI0IDE1LjIyMDcgMTYuNzgyMyAxNi41OTY2TDE2LjczOTMgMTYuOTc0NUMxNi43MjcgMTcuMDYxOCAxNi42ODM5IDE3LjE0MTkgMTYuNjE3NyAxNy4yMDAyQzE2LjU1MTYgMTcuMjU4NSAxNi40NjY3IDE3LjI5MTEgMTYuMzc4NiAxNy4yOTIzSDEzLjgwMThDMTIuODUxOCAxNy4zMzk5IDExLjk1NSAxNy43NDU1IDExLjI5MjEgMTguNDI3NkMxMC42MjkxIDE5LjEwOTcgMTAuMjQ5MSAyMC4wMTc2IDEwLjIyODYgMjAuOTY4NkMxMC4yMjg2IDIxLjAyODcgMTAuMjI4NiAyMS4wODAyIDEwLjIyODYgMjEuMTQwNEMxMC4yMjg2IDIxLjIwMDUgMTAuMjI4NiAyMS42NDcxIDEwLjIyODYgMjEuOTMwNkMxMC4yMjg2IDIxLjk2MSAxMC4yMjI2IDIxLjk5MTIgMTAuMjExIDIyLjAxOTNDMTAuMTk5MyAyMi4wNDc1IDEwLjE4MjIgMjIuMDczIDEwLjE2MDcgMjIuMDk0NkMxMC4xMzkxIDIyLjExNjEgMTAuMTEzNiAyMi4xMzMyIDEwLjA4NTQgMjIuMTQ0OEMxMC4wNTczIDIyLjE1NjUgMTAuMDI3MiAyMi4xNjI1IDkuOTk2NyAyMi4xNjI1QzkuNTM4NzggMjIuMTcwMSA5LjA4Nzc3IDIyLjI3NTUgOC42NzM5MyAyMi40NzE3QzguMTY5NjQgMjIuNzA4MiA3LjczMzQ0IDIzLjA2ODUgNy40MDYwMiAyMy41MTkxQzcuMDc4NiAyMy45Njk3IDYuODcwNjIgMjQuNDk1OCA2LjgwMTQ3IDI1LjA0ODVDNi43NzQwMiAyNS4yMjE4IDYuNzU5NjYgMjUuMzk3IDYuNzU4NTIgMjUuNTcyNEM2Ljc1NzQ5IDI2LjQyNjUgNy4wODUyMiAyNy4yNDgxIDcuNjczNzMgMjcuODY3QzguMjYyMjQgMjguNDg1OSA5LjA2NjM5IDI4Ljg1NDYgOS45MTk0IDI4Ljg5NjVIMjEuNDAzM0gyMS42ODY4QzIyLjIzMzIgMjguODIzNCAyMi43MzQzIDI4LjU1MzggMjMuMDk2MyAyOC4xMzhDMjMuNDU4MyAyNy43MjIyIDIzLjY1NjUgMjcuMTg4OCAyMy42NTM3IDI2LjYzNzVWMTcuNzA0NkMyMy42NTM3IDE3LjYwNDQgMjMuNjkzNSAxNy41MDgzIDIzLjc2NDQgMTcuNDM3NEMyMy44MzUzIDE3LjM2NjUgMjMuOTMxNCAxNy4zMjY3IDI0LjAzMTYgMTcuMzI2N0gyNC45ODUxQzI1LjAzNDMgMTcuMzI2NyAyNS4wODMgMTcuMzM2NSAyNS4xMjg0IDE3LjM1NTZDMjUuMTczOCAxNy4zNzQ3IDI1LjIxNDkgMTcuNDAyNyAyNS4yNDkzIDE3LjQzNzlDMjUuMjgzNyAxNy40NzMxIDI1LjMxMDcgMTcuNTE0OCAyNS4zMjg4IDE3LjU2MDZDMjUuMzQ2OCAxNy42MDY1IDI1LjM1NTUgMTcuNjU1NCAyNS4zNTQ0IDE3LjcwNDZWMjYuODE3OUMyNS4zMDc0IDI3Ljc0NTQgMjQuOTM4NyAyOC42Mjc2IDI0LjMxMTcgMjkuMzEyNkMyMy42ODQ2IDI5Ljk5NzcgMjIuODM4NCAzMC40NDI4IDIxLjkxODcgMzAuNTcxNEgyMS42ODY4SDEwLjA4MjZDOC44ODY2MSAzMC41NTQ3IDcuNzM1MzcgMzAuMTE0MSA2LjgzMzg1IDI5LjMyODFDNS45MzIzNCAyOC41NDIgNS4zMzkwNyAyNy40NjE1IDUuMTU5NjggMjYuMjc4OUM0Ljk4MDI4IDI1LjA5NjMgNS4yMjY0MiAyMy44ODg1IDUuODU0MjQgMjIuODcwNEM2LjQ4MjA2IDIxLjg1MjMgNy40NTA4MyAyMS4wOTAxIDguNTg4MDUgMjAuNzE5NUM4LjcwMjQxIDE5LjQ0MjggOS4yNTY1NiAxOC4yNDU1IDEwLjE1NTggMTcuMzMyMkMxMS4wNTUxIDE2LjQxODggMTIuMjQzNiAxNS44NDYxIDEzLjUxODMgMTUuNzExOVYxNS43MTE5SDEzLjYyMTRDMTMuNzU4OCAxNS43MTE5IDE0LjAxNjUgMTUuNzExOSAxNC40ODAzIDE1LjcxMTlIMTUuMzM5M0MxNS43NTk0IDE0LjA4NjYgMTYuNzA0NSAxMi42NDU1IDE4LjAyNzkgMTEuNjEyNkMxOS4zNTEyIDEwLjU3OTcgMjAuOTc4NyAxMC4wMTI4IDIyLjY1NzQgMTBIMjIuNjY1OVoiIGZpbGw9IndoaXRlIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMzk6ODcwOCI+CjxyZWN0IHdpZHRoPSIzMCIgaGVpZ2h0PSIyMC41NzE0IiBmaWxsPSJ3aGl0ZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNSAxMCkiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K",
      authors: [],
      actions: [
        updateOpportunityStatus,
        createCustomApiCallAction({
          baseUrl: () => 'https://gmail.googleapis.com/gmail/v1',
          auth: oauth2Auth,
          authMapping: async (auth) => ({
            Authorization: `Bearer ${(auth as OAuth2PropertyValue).access_token}`,
          }),
        }),
      ],
      triggers: [estimateStepUpdated],
    });
